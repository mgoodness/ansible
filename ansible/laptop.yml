# Ansible
---

- hosts: 127.0.0.1
  vars:
    st_dir: /opt/sublime_text
  tasks:    
    - name: get 1920x1080 modeline
      command: cvt -r 1920 1080 60
      register: modeline
      changed_when: false

    - name: create xorg.conf with 1920x1080 modeline
      sudo: true
      template: >
        src=xorg.conf.j2
        dest=/etc/X11/xorg.conf.new
        owner=root
        group=root
        mode=0644
      notify: restart X

    - name: add Google GPG key
      rpm_key: >
        key=https://dl-ssl.google.com/linux/linux_signing_key.pub
        state=present

    - name: add Google Chrome repo
      sudo: true
      file: >
        src=google-chrome.repo
        dest=/etc/yum.repos.d/google-chrome.repo
        owner=root
        group=root
        mode=0644

    - name: add Google Talk plugin repo
      sudo: true
      file: >
        src=google-talkplugin.repo
        dest=/etc/yum.repos.d/google-talkplugin.repo
        owner=root
        group=root
        mode=0644

    - name: install packages
      sudo: true
      yum: pkg={{ item }} state=present update_cache=true
      with_items:
        - docker-io
        - gnome-tweak-tool
        - google-chrome-stable
        - google-droid-sans-fonts
        - google-droid-sans-mono-fonts
        - google-droid-serif-fonts
        - google-talkplugin
        - tlp
        - vim-X11
        - zsh

    - name: start TLP
      sudo: true
      service: name=tlp enabled=true state=started

    - name: start Docker
      sudo: true
      service: name=docker enabled=true state=started

    - name: schedule monthly fstrim on /
      sudo: true
      file: >
        src=fstrim.sh
        dest=/etc/cron.monthly
        owner=root
        group=root
        mode=0755

    - name: install Vagrant
      sudo: true
      yum: >
        pkg=https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.0_x86_64.rpm
        state=present

    - name: download Sublime Text
      get_url: >
        url=http://c758482.r82.cf2.rackcdn.com/sublime_text_3_build_3065_x64.tar.bz2
        dest=/tmp/st3.tar.bz2

    - name: install Sublime Text
      sudo: true
      unarchive: >
        src=/tmp/st3.tar.bz2
        dest=/opt
        copy=no

    - name: create Sublime Text shell link
      sudo: true
      file: >
        src={{ st_dir }}/sublime_text
        dest=/usr/local/bin/subl
        owner=root
        group=root
        state=link

    - name: create Sublime Text desktop item
      sudo: true
      file: >
        src={{ st_dir }}/sublime_text.desktop
        dest=/usr/share/applications/sublime_text.desktop
        owner=root
        group=root
        state=link

    - name: fix Sublime Text icon
      sudo: true
      lineinfile: >
        dest={{ st_dir }}/sublime_text.desktop
        regexp=^Icon=
        line=Icon={{ st_dir }}/Icon/128x128/sublime-text.png

    - name: install Package Control
      get_url: >
        url=https://sublime.wbond.net/Package%20Control.sublime-package
        dest={{ st_dir }}/Packages/Package\ Control.sublime-package
        owner=root
        group=root
        mode=0664
  handlers:
    - name: restart X
      sudo: true
      service: name=graphical.target state=restarted

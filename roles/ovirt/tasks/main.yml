---
# tasks file for ovirt

- name: Install oVirt repository
  sudo: true
  yum: name={{ ovirt_repo }} state=present
  tags: ovirt

- name: Disable NetworkManager service
  sudo: true
  service: enabled=false name=NetworkManager state=stopped
  tags: ovirt

- name: Enable network service
  sudo: true
  service: enabled=true name=network state=started
  tags: ovirt

#- name: Create ovirtmgmt bonded interface for VDSM

- name: Open ports in firewalld
  sudo: true
  firewalld: permanent=true port={{ item }} state=enabled
  with_items: ovirt_ports
  notify: Restart firewalld
  tags: ovirt

- name: Create ovirt-engine entry in /etc/hosts
  sudo: true
  lineinfile:
    dest=/etc/hosts
    line="{{ ovirt_engine.address }} {{ ovirt_engine.hostname}}.{{ ansible_domain }}"
    regexp='.*{{ ovirt_engine.hostname }}\.{{ ansible_domain }}$'
    state=present
  tags: ovirt

# Necessary for hosted-engine appliance?
- name: Install hosted oVirt engine setup
  sudo: true
  yum: name=ovirt-hosted-engine-setup state=present
  tags: ovirt

#- name: Deploy hosted-engine appliance
#  run_once: true
#  delegate_to: node0.goodnesstech.net

#- name: Deploy additional node
#  cmd: hosted-engine --deploy --config-append=hosted_engine-answers.conf
